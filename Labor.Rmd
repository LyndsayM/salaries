---
title: "Analysis of Epidemiologist Wages, May 2022"
author: "Lyndsay Miles"
date: "`r Sys.Date()`"
output: html_document
---

I am just a few weeks from completing an MPH (Epidemiology and Biostatistics concentration) and my thoughts are on the job market as I comb through opportunities and talk with peers and mentors. To better understand the labor market, it was helpful to look at recent labor statistics. To compare apples to apples, I adjusted salaries by 2023 cost of living estimates.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, include=FALSE}
library(tidyverse)
library(readr)
library(kableExtra)
library(ggplot2)
library(reactable)
library(DT)
library(plotly)
```

```{r, echo=FALSE, include=FALSE}
#coli data from kaggle
coli <- read.csv("data/cost_of_living_missouri_economic_research_and_information_center.csv") 
salary <- read.csv("data/oes_research_2022_allsectors_abbr.csv")
#states data from https://developers.google.com/public-data/docs/canonical/states_csv
states <- read.csv("data/states.csv")
```

```{r, echo=FALSE, include=FALSE}
salary_clean <- salary %>% 
  rename_with( ~ tolower(gsub(" ", "", .x, fixed = TRUE))) %>%
  select(area, area_title, naics, naics_title, occ_title, tot_emp, a_mean) %>%
  rename(name = area_title)
 

salary_clean$a_mean <- as.numeric(salary_clean$a_mean)
salary_clean$tot_emp <- as.integer(salary_clean$tot_emp)
#for expedience, I decided to drop NAs for now. 
salary_clean <- salary_clean %>% drop_na()

```

```{r, echo=FALSE, include=FALSE}
coli_clean <- coli %>% 
  rename_with( ~ tolower(gsub(" ", "", .x, fixed = TRUE))) %>%
  select(state, conversion) %>%
  mutate(conversion_adj = conversion/100)

#remove non-US states
coli_clean <- coli_clean[!(coli_clean$state == "Remote" |
                             coli_clean$state == "British Columbia"|
                             coli_clean$state == "Ontario"),]
  
```

```{r, echo=FALSE, include=FALSE}
#join the 3 datasets 
salary_joined <- salary_clean %>%
  left_join(states, by = "name")%>%
  left_join(coli_clean, by = "state") 
```

```{r, echo=FALSE, include=FALSE}
#add an adjusted salary, weighted by the cost of living index

salary_joined_adj <- salary_joined %>% 
  group_by(name, naics, naics_title, occ_title) %>%
  mutate(adjusted_sal = (a_mean * (1+(1-(conversion/100) )))) %>%
  arrange(name, naics, naics_title, occ_title)
```

```{r, echo=FALSE, include=FALSE}
#just epidemiologists
salary_epis <- salary_joined_adj %>% 
  filter(occ_title == "Epidemiologists")
```

```{r, echo=FALSE}
#barchart 
#table of jobs by group title
#included this information in the table above
epi_jobs_num_table <- salary_epis %>%
  group_by(naics_title) %>% 
  summarize(num_jobs = sum(tot_emp)) %>% 
  arrange(desc(num_jobs))
epi_jobs_num_table %>% 
  
ggplot(aes(x = reorder(naics_title, num_jobs), y = num_jobs, fill=naics_title)) + 
  geom_col() +
  scale_x_discrete(label=function(x) stringr::str_trunc(x, 20))+
  labs(x = "", y = "", title = "Figure 1: Total number of persons employed as epidemiologists", subtitle = "May 2022, by NAICS group")+
  theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1, vjust = 0.9),
        legend.position="none")

```

It was helpful to start by looking at count of epidemiologists by group in a bar chart. This hits home what a huge employer federal, state, and local governments are for those working in this field (Figure 1).

Then I grouped epidemiologists by NAICS group title and reported the average mean adjusted annual wage and total employed by group (Table 1).

```{r, echo=FALSE}
#Table of epi salaries by NAICS group with adjusted salaries
epi_job_groups_table <- salary_epis %>%
  group_by(naics_title) %>%
  summarize(mean_adj_income = mean(adjusted_sal),
            num_jobs = sum(tot_emp)) %>% 
  arrange(desc(mean_adj_income))
  
kable(epi_job_groups_table,
      booktabs = T,
      col.names = c("Group title", "Mean adjusted annual wage ($US)", "Total employed"),
      caption = "Table 1: Mean adjusted income by group for epidemiologists (adjusted by cost of living)") %>%
  kable_styling(full_width = F)
```

```{r, include=FALSE, echo=FALSE}


epi_jobs_num_table <- data.frame(epi_jobs_num_table) 
epi_jobs_num_table$naics_title <- as.factor(epi_jobs_num_table$naics_title)

kable(epi_jobs_num_table,
      booktabs = T,
      col.names = c("Group title", "Number of jobs"),
      caption = "Number of epidemiologist jobs by NAICS group") %>%
  kable_styling(full_width = F)
```

Now I knew in which industry groups epidemiologists were employed and what the salary range looked like, but where in the United States would an epidemiologist most likely to be employed and and also get a higher salary? I grouped the data by state and used percent_rank() to determine which states fell in the top 25% for number employed and which landed in the top 25% for highest average adjusted annual wage. States who scored highly in both of these rankings are highlighted in green in the interactive table below (Table 2). Note that I did not take into consideration a state's population size, which should be considered when looking at these rankings. For example, it makes sense that a large state like California employs a large number of epidemiologists, and a less populated state like Alaska employs fewer (70).

```{r, echo=FALSE, include=FALSE}
#what are number of jobs available by state?
#in what state do you have the most jobs and also the most pay for epidemiologists?
#for example, New Jersey is fairly high on the list in terms of income and also high # of jobs (11 out of 54 - includes Puerto Rico, Guam, US Virgin Islands, and Washington DC)
#assign each state a # between 1 and 54 for their income level & another assign # for their job availability
jobs_by_state <- salary_epis %>% 
  group_by(name) %>% 
  summarize(tot_jobs = sum(tot_emp),
            avg_pay = round(mean(a_mean),2)) %>% 
  mutate(rank_most_jobs = percent_rank(tot_jobs),
         most_jobs = ifelse(rank_most_jobs >= 0.75, 1, 0),
         rank_most_pay = (percent_rank(avg_pay)),
         most_pay = ifelse(rank_most_pay >= 0.75, 1,0),
         best_both = ifelse(most_jobs == 1 & most_pay == 1, 1, 0)
         ) %>%
  arrange(desc(best_both), desc(most_pay))

jobs_by_state_table <- jobs_by_state %>%
  select(name, tot_jobs, avg_pay, rank_most_jobs, rank_most_pay, best_both)
```

```{r, echo=FALSE}
datatable(
  data = jobs_by_state_table,
  class = 'cell-border stripe',
  rownames = FALSE,
  colnames = c("U.S. State", "Total epidemiologists employed", "Annual adjusted mean wage ($US)", "State rank for # of epidemiologists employed (1=highest)", "State rank for salary value (1=highest)", "States ranked for both rankings (1=both)"),
  extensions = 'Buttons', options = list(dom = 'Bfrtip',
                                                 buttons = c('copy', 
                                                             'csv', 
                                                             'excel', 
                                                             'pdf', 
                                                             'print'),
                                                 #how many entries per page
                                                 pageLength = 10,
                                                 #options for "Show how many entries"
                                                 lengthMenu = c(10, 20, 30))) %>%
  formatStyle("name", fontWeight = "bold", color = "#2A0D5D") %>%
  formatRound("avg_pay", 2) %>%
  formatStyle("best_both", 
              target = "row",
              backgroundColor = styleEqual(c(0,1), c("white", "#ADDFB3")))
```

Finally, I created a scatter plot to see where each state lands in terms of correlation between the number employed as epidemiologists and the average adjusted annual wage. I see a couple of outliers (e.g., average wage in New Jersey is high, but the number employed (440) is fairly low) but for the most part, states tend to have fewer than 500 epidemiologists and pay in the \$60K-\$90K range. However, there is a weak positive association (Pearson correlation coefficient = 0.38).

```{r, echo=FALSE}
plot1 <- jobs_by_state %>% 
  ggplot(aes(x=tot_jobs, y=avg_pay, label=name)) +
  geom_point()+
  
  geom_abline(intercept=72198.52859, slope=12.25004, color="blue")+
  #geom_smooth(method = "lm", se = FALSE)+
  labs(x="Number of persons employed as epidemiologists, May 2022", y="Average adjusted annual wage ($US)", caption = "Data source: U.S. Bureau of Labor Statistics")+
  theme_bw()
```

```{r, echo=FALSE, include=FALSE}
#calculate intercept/slope
coef(lm(avg_pay~tot_jobs, data=jobs_by_state))
#72198.53
#12.25
cor(jobs_by_state$tot_jobs, jobs_by_state$avg_pay)
#0.3865659
```

```{r, echo=FALSE}
ggplotly(plot1)
```

```{r, echo=FALSE, include=FALSE}
#epis without naics distinction "Federal, State, and Local Government, excluding state and local schools and hospitals and the U.S. Postal Service (OES Designation)"
salary_epis_no_gov <- salary_joined_adj %>% 
  filter(occ_title == "Epidemiologists" & naics != "99" & naics != "999000")
```

### Data

I used the most recent data tables provided by the U.S. Bureau of Labor Statistics (Research estimates by state and industry/all sectors). This data is derived from sample surveys, which are subject to sampling and non-sampling error. To take into consideration variations in cost of living from state to state, I adjusted salary values using the Missouri Economic Research and Information Center (MERIC) cost of living estimates for 2023. According to their website, MERIC arrives an the cost of living index by averaging the indices of cities and metropolitan areas in a state.

To conduct this analysis, I cleaned and joined these two data sets and filtered to only include observations where the occupational title is "Epidemiologists". I used the following variables:

-   State name

-   North American Industry Classification System (NAICS) title for the given industry

-   Standard Occupational Classification title or OEWS specific title for the occupation

-   Mean annual wage

-   Estimated total employed rounded to the nearest 10 (excludes self-employed).

I then calculated the mean adjusted annual wage by creating a new variable using this formula:

> $adjusted salary = (mean Annual Salary(1 + 1-cost Of Living Index/100))$

### Conclusions

The majority of epidemiologists employed in May 2022 (10,000+) worked in federal, state, and local government and their average salary fell somewhere in the middle of the pack in terms of NAICS industry groups. Those with the largest incomes work in, e.g., Research and development in the physical, engineering, and life sciences (370), and professional, scientific, and technical services (980), but there are fewer people employed in this categories compared to government roles.

Five states score highly in terms of employing high numbers of epidemiologists and paying the highest average salaries: California, Maryland, Massachusetts, Minnesota, and Washington. New Mexico and Rhode Island employed the fewest epidemiologists. Annual adjusted mean wages for epidemiologists were lowest in Mississippi and Louisiana. \## Limitations

The salary data used is from May 2022, and more recent data would be beneficial. This snapshot captures a period of time in which local, state, and federal governments were hiring and retaining more epidemiologists than usual because of the COVID-19 pandemic response. For brevity, I chose to focus on mean adjusted annual income, but looking at salary ranges would be meaningful as well. There are also many other job titles that epidemiologists work under, including research analyst, data analyst, and research manager. This analysis only captures salaries and number employed with the title "epidemiologists" so this gives us an incomplete picture.

### References

U.S. Bureau of Labor Statistics. (2023, April 27). Tables created by BLS. U.S. Bureau of Labor Statistics. Retrieved March 21, 2024 from <https://www.bls.gov/oes/tables.htm>.

Karol Łukaszczyk. (June 2023). Cost of living in State in USA - MERIC (adapted from Missouri Economic Research and Information Center's Cost of Living Data Series), Version 1. Retrieved March 21, 2024 from <https://www.kaggle.com/datasets/lukkardata/cost-of-living-missouri-economic-research>.

Link to the code for this analysis: <https://github.com/LyndsayM/salaries>
