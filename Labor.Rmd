---
title: "Labor - Analysis of Epidemiology Salaries"
author: "Lyndsay Miles"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readr)
```

```{r}
#coli data from kaggle
coli <- read.csv("data/cost_of_living_missouri_economic_research_and_information_center.csv") 
salary <- read.csv("data/oes_research_2022_allsectors_abbr.csv")
#states data from https://developers.google.com/public-data/docs/canonical/states_csv
states <- read.csv("data/states.csv")
```

```{r}
salary_clean <- salary %>% 
  rename_with( ~ tolower(gsub(" ", "", .x, fixed = TRUE))) %>%
  select(area, area_title, naics, naics_title, occ_title, tot_emp, a_mean) %>%
  rename(name = area_title)

salary_clean$a_mean <- as.numeric(salary_clean$a_mean)
salary_clean$tot_emp <- as.integer(salary_clean$tot_emp)
#for expedience, I decided to drop NAs for now. Might review them at another time
salary_clean <- salary_clean %>% drop_na()

```

```{r}
coli_clean <- coli %>% 
  rename_with( ~ tolower(gsub(" ", "", .x, fixed = TRUE))) %>%
  select(state, conversion) %>%
  mutate(conversion_adj = conversion/100)
  
```

```{r}
salary_joined <- salary_clean %>%
  left_join(states, by = "name")%>%
  left_join(coli_clean, by = "state") 
```


```{r}
salary_joined_adj <- salary_joined %>% 
group_by(name, naics, naics_title, occ_title) %>%
  summarize(
    total_a_mean = sum(a_mean), 
    a_mean_adj = weighted.mean(a_mean, conversion_adj)) %>%
    arrange(name, naics, naics_title, occ_title)
```


```{r}
salary_joined_adj %>%
  group_by(naics_title) %>%
  filter(occ_title == "Epidemiologists") %>% 
  summarize(mean_adj_income = mean(a_mean_adj)) %>% 
  arrange(desc(mean_adj_income))
  print()
```

